<?xml version="1.0" encoding="UTF-8"?>
<project>
    <!-- Basic Project Information -->
    <shortName>${PRODUCT_SHORT_NAME}</shortName>
    <fullName>${PRODUCT_NAME}</fullName>
    <version>${PRODUCT_VERSION}</version>
    <installerFilename>${INSTALLER_FILENAME}</installerFilename>

    <!-- Vendor Information -->
    <vendor>${VENDOR_NAME}</vendor>
    <description>${PRODUCT_DESCRIPTION}</description>

    <!-- Installation Directory -->
    <defaultInstallationDirectory>${DEFAULT_INSTALL_DIR}</defaultInstallationDirectory>

    <!-- Linux-specific default installation directory -->
    <platformOptionsList>
        <platformOptions>
            <platform>linux</platform>
            <defaultInstallationDirectory>${system_home_directory}/Keysight</defaultInstallationDirectory>
        </platformOptions>
    </platformOptionsList>

    <!-- License Configuration -->
    <licenseFile>${LICENSE_FILE}</licenseFile>

    <!-- Readme/Documentation -->
    <readmeFile>${README_FILE}</readmeFile>

    <!-- Enable/Disable platforms -->
    <enabledPlatforms>
        <platform>${ENABLED_PLATFORMS}</platform>
    </enabledPlatforms>

    <!-- Component List -->
    <!-- Components are loaded from external file specified in ${COMPONENTS_FILE} variable -->
    <!-- This allows each product to have its own set of components -->
    <componentList>
        <include>${COMPONENTS_FILE}</include>
    </componentList>

    <!-- Post Installation Actions -->
    <postInstallationActionList>
        <!-- Windows specific post-install actions -->
        <actionGroup>
            <actionList>
                <registrySet>
                    <key>${REGISTRY_KEY}</key>
                    <name>InstallPath</name>
                    <value>${installdir}</value>
                    <type>REG_SZ</type>
                </registrySet>
                <registrySet>
                    <key>${REGISTRY_KEY}</key>
                    <name>Version</name>
                    <value>${PRODUCT_VERSION}</value>
                    <type>REG_SZ</type>
                </registrySet>
                <addDirectoryToPath>
                    <insertAt>${ADD_TO_PATH_POSITION}</insertAt>
                    <path>${installdir}/bin</path>
                </addDirectoryToPath>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>

        <!-- Linux specific post-install actions -->
        <actionGroup>
            <actionList>
                <changePermissions>
                    <files>${installdir}/${LINUX_EXECUTABLE}</files>
                    <permissions>0755</permissions>
                </changePermissions>
                <runProgram>
                    <program>ln</program>
                    <programArguments>-sf ${installdir}/bin/${LINUX_EXECUTABLE} /usr/local/bin/${PRODUCT_SHORT_NAME}</programArguments>
                    <abortOnError>0</abortOnError>
                    <showMessageOnError>0</showMessageOnError>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </actionGroup>

        <!-- Linux Aliases Installation -->
        <actionGroup>
            <actionList>
                <substitute>
                    <files>${system.home}/.bash_aliases</files>
                    <type>regexp</type>
                    <substitutionList>
                        <substitution>
                            <pattern># ${PRODUCT_NAME} Aliases.*# End ${PRODUCT_NAME} Aliases</pattern>
                            <value></value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <addTextToFile>
                    <path>${system.home}/.bash_aliases</path>
                    <text># ${PRODUCT_NAME} Aliases - Installed on ${date}
# Launch ${PRODUCT_NAME}
alias ${PRODUCT_SHORT_NAME}='${installdir}/${LINUX_EXECUTABLE}'
# Show ${PRODUCT_NAME} help
alias ${PRODUCT_SHORT_NAME}-help='${installdir}/${LINUX_EXECUTABLE} --help'
# Configure ${PRODUCT_NAME}
alias ${PRODUCT_SHORT_NAME}-config='${installdir}/${LINUX_EXECUTABLE} --settings'
# Navigate to ${PRODUCT_NAME} installation directory
alias cd-${PRODUCT_SHORT_NAME}='cd ${installdir}'
# End ${PRODUCT_NAME} Aliases
</text>
                    <append>1</append>
                </addTextToFile>
                <showInfo>
                    <text>Shell aliases have been added to ${system.home}/.bash_aliases

To use the aliases immediately, run:
    source ~/.bash_aliases

Or restart your terminal.

Available aliases:
  ${PRODUCT_SHORT_NAME}         - Launch the application
  ${PRODUCT_SHORT_NAME}-help    - Show help
  ${PRODUCT_SHORT_NAME}-config  - Open settings
  cd-${PRODUCT_SHORT_NAME}      - Go to install directory</text>
                    <title>Linux Aliases Installed</title>
                </showInfo>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
                <isTrue>
                    <value>${INSTALL_LINUX_ALIASES}</value>
                </isTrue>
            </ruleList>
        </actionGroup>
    </postInstallationActionList>

    <!-- Uninstaller Actions -->
    <preUninstallationActionList>
        <!-- Windows uninstall cleanup -->
        <actionGroup>
            <actionList>
                <registryDelete>
                    <key>${REGISTRY_KEY}</key>
                </registryDelete>
                <removeDirectoryFromPath>
                    <path>${installdir}/bin</path>
                </removeDirectoryFromPath>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>

        <!-- Linux uninstall cleanup -->
        <actionGroup>
            <actionList>
                <deleteFile>
                    <path>/usr/local/bin/${PRODUCT_SHORT_NAME}</path>
                </deleteFile>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </actionGroup>
    </preUninstallationActionList>

    <!-- Parameter List for Installation Wizard -->
    <parameterList>
        <!-- Custom installation directory parameter -->
        <directoryParameter>
            <name>installdir</name>
            <description>Installation Directory</description>
            <explanation>Select the directory where ${PRODUCT_NAME} will be installed</explanation>
            <value>${DEFAULT_INSTALL_DIR}</value>
            <default>${DEFAULT_INSTALL_DIR}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>1</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
        </directoryParameter>

        <!-- License acceptance parameter for unattended mode -->
        <booleanParameter>
            <name>license_accepted</name>
            <description>Accept License</description>
            <explanation>Accept the license agreement</explanation>
            <value>0</value>
            <default>0</default>
            <ask>0</ask>
            <cliOptionName>accept-license</cliOptionName>
        </booleanParameter>

        <!-- Add to PATH option (Windows) -->
        <booleanParameter>
            <name>add_to_path</name>
            <description>Add to System PATH</description>
            <explanation>Add ${PRODUCT_SHORT_NAME} to the system PATH environment variable</explanation>
            <value>${ADD_TO_PATH_DEFAULT}</value>
            <default>${ADD_TO_PATH_DEFAULT}</default>
            <ask>1</ask>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </booleanParameter>

        <!-- Create Desktop Shortcut option -->
        <booleanParameter>
            <name>create_desktop_shortcut</name>
            <description>Create Desktop Shortcut</description>
            <explanation>Create a shortcut on the desktop</explanation>
            <value>${CREATE_DESKTOP_SHORTCUT_DEFAULT}</value>
            <default>${CREATE_DESKTOP_SHORTCUT_DEFAULT}</default>
            <ask>1</ask>
        </booleanParameter>
    </parameterList>

    <!-- Platform Specific Settings -->
    <platformSettings>
        <!-- Windows Settings -->
        <windows>
            <allowWindowsDesktopShortcut>1</allowWindowsDesktopShortcut>
            <createUninstaller>1</createUninstaller>
            <uninstallerName>${UNINSTALLER_NAME}</uninstallerName>
            <uninstallerIcon>${WINDOWS_ICON}</uninstallerIcon>
            <uninstallDisplayName>${PRODUCT_NAME}</uninstallDisplayName>
            <uninstallDisplayIcon>${installdir}/${WINDOWS_ICON}</uninstallDisplayIcon>
            <requestUninstallerElevation>1</requestUninstallerElevation>
            <installElevationRequired>1</installElevationRequired>
        </windows>

        <!-- Linux Settings -->
        <linux>
            <allowComponentSelection>1</allowComponentSelection>
            <createUninstaller>1</createUninstaller>
            <uninstallerName>uninstall</uninstallerName>
        </linux>
    </platformSettings>

    <!-- Finalization Settings -->
    <finalPageActionList>
        <runProgram>
            <program>${installdir}/${WINDOWS_EXECUTABLE}</program>
            <programArguments></programArguments>
            <ruleList>
                <isTrue>
                    <value>${launch_application}</value>
                </isTrue>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <runProgram>
            <program>${installdir}/${LINUX_EXECUTABLE}</program>
            <programArguments></programArguments>
            <ruleList>
                <isTrue>
                    <value>${launch_application}</value>
                </isTrue>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </runProgram>
    </finalPageActionList>

    <!-- Additional Parameters -->
    <compressionAlgorithm>lzma-ultra</compressionAlgorithm>
    <enableRollback>1</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <saveRelativePaths>1</saveRelativePaths>
    <allowLanguageSelection>1</allowLanguageSelection>
    <languageList>
        <language>en</language>
    </languageList>

    <!-- Unattended/Silent Installation Support -->
    <allowedModes>gtk qt text unattended</allowedModes>
    <defaultUnattendedModeUI>none</defaultUnattendedModeUI>

    <!-- Splash Screen Configuration -->
    <splashImage>${SPLASH_IMAGE}</splashImage>
    <splashScreenShowProgressText>1</splashScreenShowProgressText>

    <!-- Custom Page List -->
    <customPageList>
        <!-- Custom Welcome Page with System Information Button -->
        <customWelcomePage>
            <name>welcome</name>
            <title>${PRODUCT_NAME} Installation</title>
            <description>Welcome to the ${PRODUCT_NAME} ${PRODUCT_VERSION} Setup Wizard</description>
            <explanation>This wizard will guide you through the installation of ${PRODUCT_NAME}.

Click "System Information" to view your system details, or click "Next" to continue with the installation.</explanation>
            <allowBack>0</allowBack>
            <buttonList>
                <!-- System Information Button -->
                <button>
                    <title>System Information</title>
                    <actionList>
                        <!-- Gather System Information -->
                        <getComputerName>
                            <variable>system_model</variable>
                        </getComputerName>
                        <setInstallerVariable>
                            <name>system_os</name>
                            <value>${platform_name}</value>
                        </setInstallerVariable>
                        <runProgram>
                            <program>wmic</program>
                            <programArguments>cpu get name</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariableFromRegEx>
                            <name>system_cpu</name>
                            <pattern>^Name\s*(.+)$</pattern>
                            <substitution>\1</substitution>
                            <text>${program_stdout}</text>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariableFromRegEx>
                        <runProgram>
                            <program>wmic</program>
                            <programArguments>computersystem get totalphysicalmemory</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariableFromRegEx>
                            <name>system_ram_bytes</name>
                            <pattern>^TotalPhysicalMemory\s*(\d+)$</pattern>
                            <substitution>\1</substitution>
                            <text>${program_stdout}</text>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariableFromRegEx>
                        <mathExpression>
                            <result>system_ram_gb</result>
                            <expression>${system_ram_bytes} / 1073741824</expression>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </mathExpression>
                        <runProgram>
                            <program>wmic</program>
                            <programArguments>path win32_videocontroller get name</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariableFromRegEx>
                            <name>system_video</name>
                            <pattern>^Name\s*(.+)$</pattern>
                            <substitution>\1</substitution>
                            <text>${program_stdout}</text>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariableFromRegEx>
                        <runProgram>
                            <program>wmic</program>
                            <programArguments>path Win32_VideoController get CurrentHorizontalResolution,CurrentVerticalResolution</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariableFromRegEx>
                            <name>system_screen</name>
                            <pattern>(\d+)\s+(\d+)</pattern>
                            <substitution>\1 x \2</substitution>
                            <text>${program_stdout}</text>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariableFromRegEx>
                        <setInstallerVariable>
                            <name>user_admin</name>
                            <value>No</value>
                        </setInstallerVariable>
                        <setInstallerVariable>
                            <name>user_admin</name>
                            <value>Yes</value>
                            <ruleList>
                                <isTrue>
                                    <value>${installer_ui_mode}</value>
                                </isTrue>
                                <compareText>
                                    <logic>equals</logic>
                                    <text>${windows_user_account_type}</text>
                                    <value>admin</value>
                                </compareText>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <!-- Linux System Information -->
                        <runProgram>
                            <program>bash</program>
                            <programArguments>-c "cat /sys/devices/virtual/dmi/id/product_name 2>/dev/null || echo 'Unknown'"</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariable>
                            <name>system_model</name>
                            <value>${program_stdout}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <runProgram>
                            <program>bash</program>
                            <programArguments>-c "grep -m 1 'model name' /proc/cpuinfo | cut -d':' -f2 | xargs"</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariable>
                            <name>system_cpu</name>
                            <value>${program_stdout}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <runProgram>
                            <program>bash</program>
                            <programArguments>-c "free -g | grep Mem | awk '{print $2}'"</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariable>
                            <name>system_ram_gb</name>
                            <value>${program_stdout}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <runProgram>
                            <program>bash</program>
                            <programArguments>-c "lspci | grep -i vga | cut -d':' -f3 | xargs"</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariable>
                            <name>system_video</name>
                            <value>${program_stdout}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <runProgram>
                            <program>bash</program>
                            <programArguments>-c "xrandr 2>/dev/null | grep '*' | awk '{print $1}' | head -1 || echo 'Unknown'"</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariable>
                            <name>system_screen</name>
                            <value>${program_stdout}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <runProgram>
                            <program>bash</program>
                            <programArguments>-c "if groups | grep -q 'sudo\|wheel'; then echo 'Yes'; else echo 'No'; fi"</programArguments>
                            <abortOnError>0</abortOnError>
                            <showMessageOnError>0</showMessageOnError>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </runProgram>
                        <setInstallerVariable>
                            <name>user_admin</name>
                            <value>${program_stdout}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <!-- Display System Information -->
                        <showInfo>
                            <title>System Information</title>
                            <text>Model: ${system_model}
OS: ${system_os}
CPU: ${system_cpu}
RAM: ${system_ram_gb} GB
VIDEO: ${system_video}
SCREEN: ${system_screen}

User Account Type: ${user_admin} admin privileges</text>
                        </showInfo>
                    </actionList>
                </button>
            </buttonList>
        </customWelcomePage>

        <!-- Custom License Agreement Page -->
        <customLicensePage>
            <name>license</name>
            <title>License Agreement</title>
            <description>End User License Agreement (EULA)</description>
            <explanation>Please read the following license agreement carefully. You must accept the terms to continue.</explanation>
            <file>${LICENSE_FILE}</file>
            <showFileChooser>0</showFileChooser>
            <showAcceptRadioButton>1</showAcceptRadioButton>
            <showDeclineRadioButton>1</showDeclineRadioButton>
            <acceptButtonText>I accept the terms in the license agreement</acceptButtonText>
            <declineButtonText>I do not accept the terms in the license agreement</declineButtonText>
            <defaultAcceptValue>0</defaultAcceptValue>
            <allowBack>1</allowBack>
            <preShowPageActionList>
                <!-- Set license_accepted to false by default -->
                <setInstallerVariable>
                    <name>license_accepted</name>
                    <value>0</value>
                </setInstallerVariable>
            </preShowPageActionList>
            <buttonList>
                <!-- Print License Button -->
                <button>
                    <title>Print</title>
                    <actionList>
                        <!-- Windows Print Action -->
                        <actionGroup>
                            <actionList>
                                <createTempFile>
                                    <variable>temp_license_file</variable>
                                    <extension>txt</extension>
                                </createTempFile>
                                <copyFile>
                                    <destination>${temp_license_file}</destination>
                                    <origin>${LICENSE_FILE}</origin>
                                </copyFile>
                                <runProgram>
                                    <program>notepad</program>
                                    <programArguments>/p "${temp_license_file}"</programArguments>
                                    <abortOnError>0</abortOnError>
                                    <showMessageOnError>0</showMessageOnError>
                                </runProgram>
                                <deleteFile>
                                    <path>${temp_license_file}</path>
                                </deleteFile>
                            </actionList>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </actionGroup>
                        <!-- Linux Print Action -->
                        <actionGroup>
                            <actionList>
                                <runProgram>
                                    <program>bash</program>
                                    <programArguments>-c "if command -v lpr &gt; /dev/null; then lpr '${LICENSE_FILE}'; elif command -v lp &gt; /dev/null; then lp '${LICENSE_FILE}'; else xdg-open '${LICENSE_FILE}'; fi"</programArguments>
                                    <abortOnError>0</abortOnError>
                                    <showMessageOnError>0</showMessageOnError>
                                </runProgram>
                            </actionList>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </actionGroup>
                    </actionList>
                </button>
            </buttonList>
            <validationActionList>
                <!-- Validation to ensure user accepts the license -->
                <throwError>
                    <text>You must accept the license agreement to continue with the installation.</text>
                    <ruleList>
                        <isFalse>
                            <value>${license_accepted}</value>
                        </isFalse>
                    </ruleList>
                </throwError>
            </validationActionList>
        </customLicensePage>

        <!-- Software Privacy Notice Page -->
        <customInfoPage>
            <name>privacynotice</name>
            <title>Software Privacy Notice</title>
            <description>Privacy Notice</description>
            <explanation>Please review the following privacy notice.</explanation>
            <file>${PRIVACY_NOTICE_FILE}</file>
            <showFileChooser>0</showFileChooser>
        </customInfoPage>

        <!-- Destination Folder Page -->
        <folderSelectionPage>
            <name>destinationfolder</name>
            <title>Destination Folder</title>
            <description>Choose Install Location</description>
            <explanation>Setup will install ${PRODUCT_NAME} in the following folder.

To install in a different folder, click Change and select another folder. Click Next to continue.</explanation>
            <destination>${installdir}</destination>
            <allowEmptyValue>0</allowEmptyValue>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>0</mustExist>
            <allowBack>1</allowBack>
            <preShowPageActionList>
                <!-- Linux: Ensure default directory is set to user's home/Keysight -->
                <actionGroup>
                    <actionList>
                        <setInstallerVariable>
                            <name>installdir</name>
                            <value>${system_home_directory}/Keysight</value>
                            <ruleList>
                                <compareText>
                                    <logic>equals</logic>
                                    <text>${installdir}</text>
                                    <value>${DEFAULT_INSTALL_DIR}</value>
                                </compareText>
                            </ruleList>
                        </setInstallerVariable>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
            </preShowPageActionList>
            <buttonList>
                <!-- Change Button -->
                <button>
                    <title>Change...</title>
                    <actionList>
                        <chooseDirectory>
                            <title>Select Installation Folder</title>
                            <explanation>Choose the folder where you want to install ${PRODUCT_NAME}</explanation>
                            <variable>installdir</variable>
                            <default>${installdir}</default>
                            <mustExist>0</mustExist>
                            <mustBeWritable>1</mustBeWritable>
                        </chooseDirectory>
                    </actionList>
                </button>
            </buttonList>
        </folderSelectionPage>

        <!-- Custom Setup Page -->
        <componentSelectionPage>
            <name>customsetup</name>
            <title>Custom Setup</title>
            <description>Select Features</description>
            <explanation>Select the features you want to install.

Click on the icons in the tree below to change how features are installed.</explanation>
            <showSizes>1</showSizes>
            <allowEmptySelection>0</allowEmptySelection>
            <showAdvancedOptions>0</showAdvancedOptions>
            <allowBack>1</allowBack>
            <componentListHelpText>Feature Description:

${component_description}</componentListHelpText>
            <preShowPageActionList>
                <!-- Calculate disk space information -->
                <setInstallerVariable>
                    <name>install_drive</name>
                    <value>${installdir}</value>
                </setInstallerVariable>
                <actionGroup>
                    <actionList>
                        <setInstallerVariableFromRegEx>
                            <name>install_drive_letter</name>
                            <pattern>^([A-Za-z]:).*</pattern>
                            <substitution>\1</substitution>
                            <text>${installdir}</text>
                        </setInstallerVariableFromRegEx>
                        <getDiskSpace>
                            <path>${install_drive_letter}</path>
                            <variable>disk_space_available</variable>
                        </getDiskSpace>
                        <mathExpression>
                            <result>disk_space_available_mb</result>
                            <expression>${disk_space_available} / 1048576</expression>
                        </mathExpression>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
                <actionGroup>
                    <actionList>
                        <getDiskSpace>
                            <path>${installdir}</path>
                            <variable>disk_space_available</variable>
                        </getDiskSpace>
                        <mathExpression>
                            <result>disk_space_available_mb</result>
                            <expression>${disk_space_available} / 1048576</expression>
                        </mathExpression>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
            </preShowPageActionList>
            <buttonList>
                <!-- Change Installation Location Button -->
                <button>
                    <title>Change...</title>
                    <actionList>
                        <chooseDirectory>
                            <title>Select Installation Folder</title>
                            <explanation>Choose the folder where you want to install ${PRODUCT_NAME}</explanation>
                            <variable>installdir</variable>
                            <default>${installdir}</default>
                            <mustExist>0</mustExist>
                            <mustBeWritable>1</mustBeWritable>
                        </chooseDirectory>
                        <!-- Recalculate disk space after changing location -->
                        <actionGroup>
                            <actionList>
                                <setInstallerVariableFromRegEx>
                                    <name>install_drive_letter</name>
                                    <pattern>^([A-Za-z]:).*</pattern>
                                    <substitution>\1</substitution>
                                    <text>${installdir}</text>
                                </setInstallerVariableFromRegEx>
                                <getDiskSpace>
                                    <path>${install_drive_letter}</path>
                                    <variable>disk_space_available</variable>
                                </getDiskSpace>
                                <mathExpression>
                                    <result>disk_space_available_mb</result>
                                    <expression>${disk_space_available} / 1048576</expression>
                                </mathExpression>
                            </actionList>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </actionGroup>
                        <actionGroup>
                            <actionList>
                                <getDiskSpace>
                                    <path>${installdir}</path>
                                    <variable>disk_space_available</variable>
                                </getDiskSpace>
                                <mathExpression>
                                    <result>disk_space_available_mb</result>
                                    <expression>${disk_space_available} / 1048576</expression>
                                </mathExpression>
                            </actionList>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </actionGroup>
                    </actionList>
                </button>
                <!-- Disk Space Button -->
                <button>
                    <title>Space</title>
                    <actionList>
                        <showInfo>
                            <title>Disk Space Information</title>
                            <text>Installation Location: ${installdir}

Available Disk Space: ${disk_space_available_mb} MB

Required Space for Selected Features: ${installation_size} MB</text>
                        </showInfo>
                    </actionList>
                </button>
                <!-- Help Button -->
                <button>
                    <title>Help</title>
                    <actionList>
                        <showInfo>
                            <title>Custom Setup Help</title>
                            <text>Custom Setup Help

You can customize which features of ${PRODUCT_NAME} to install.

How to use this page:
- Click on a component icon to select or deselect it
- Selected components (checked) will be installed
- Deselected components will not be installed
- Component descriptions appear on the right when selected

Install to: ${installdir}
- Click "Change..." to modify the installation location

Click "Space" to view available disk space information.

Click "Next" to continue with the installation.</text>
                        </showInfo>
                    </actionList>
                </button>
            </buttonList>
            <postShowPageActionList>
                <!-- Display installation location below component tree -->
                <setInstallerVariable>
                    <name>custom_setup_footer</name>
                    <value>Install to: ${installdir}</value>
                </setInstallerVariable>
            </postShowPageActionList>
        </componentSelectionPage>

        <!-- Ready to Install Page -->
        <readyToInstallPage>
            <name>readytoinstall</name>
            <title>Ready to Install the Program</title>
            <description>Ready to Install</description>
            <explanation>The wizard is ready to begin installation.

Click Next to begin the installation. If you want to review or change any settings, click Back.</explanation>
            <showSummary>1</showSummary>
            <allowBack>1</allowBack>
            <summaryText>Setup Type: Custom

Destination Location:
${installdir}

Selected Components:</summaryText>
        </readyToInstallPage>

        <!-- Installing Page -->
        <installationPage>
            <name>installing</name>
            <title>Installing ${PRODUCT_NAME}</title>
            <description>Installation in Progress</description>
            <explanation>Please wait while the Setup Wizard installs ${PRODUCT_NAME}. This may take several minutes.</explanation>
            <showProgressBar>1</showProgressBar>
            <showProgressText>1</showProgressText>
            <abortOnError>0</abortOnError>
            <enableRollbackOnError>1</enableRollbackOnError>
            <preInstallationActionList>
                <!-- Check if product is already installed -->
                <actionGroup>
                    <actionList>
                        <setInstallerVariable>
                            <name>already_installed</name>
                            <value>0</value>
                        </setInstallerVariable>
                        <!-- Check if installation directory exists and has content -->
                        <setInstallerVariable>
                            <name>already_installed</name>
                            <value>1</value>
                            <ruleList>
                                <fileTest>
                                    <condition>exists</condition>
                                    <path>${installdir}</path>
                                </fileTest>
                            </ruleList>
                        </setInstallerVariable>
                        <!-- Warn user if already installed -->
                        <showWarning>
                            <text>Warning: ${PRODUCT_NAME} appears to be already installed at:
${installdir}

The existing installation will be overwritten. Do you want to continue?</text>
                            <title>Existing Installation Detected</title>
                            <ruleList>
                                <isTrue>
                                    <value>${already_installed}</value>
                                </isTrue>
                            </ruleList>
                        </showWarning>
                    </actionList>
                </actionGroup>
            </preInstallationActionList>
        </installationPage>

        <!-- Installation Interrupted/Cancelled Page -->
        <abortedInstallationPage>
            <name>installationinterrupted</name>
            <title>Installation Interrupted</title>
            <description>Setup was interrupted</description>
            <explanation>Setup was interrupted before ${PRODUCT_NAME} could be completely installed.

Your system has not been modified. To install this program at a later time, run Setup again.

Click Finish to exit the Setup Wizard.</explanation>
            <allowBack>0</allowBack>
            <allowCancel>0</allowCancel>
        </abortedInstallationPage>

        <!-- Installation Complete Page -->
        <completionPage>
            <name>installationcomplete</name>
            <title>Installation Complete</title>
            <description>Setup Completed Successfully</description>
            <explanation>${PRODUCT_NAME} has been successfully installed on your computer.

Click Finish to exit the Setup Wizard.</explanation>
            <allowBack>0</allowBack>
            <allowCancel>0</allowCancel>
            <postShowPageActionList>
                <!-- Post-installation steps window for Linux -->
                <actionGroup>
                    <actionList>
                        <showInfo>
                            <title>Post-Installation Steps</title>
                            <text>Post-Installation Steps for ${PRODUCT_NAME}
========================================

Installation completed successfully!

Installation Location:
${installdir}

Next Steps:
-----------

1. Environment Setup (Optional):
   To use ${PRODUCT_NAME} from any terminal, add the following to your shell profile:

   For bash (~/.bashrc):
   export PATH="${installdir}/bin:$PATH"

   For zsh (~/.zshrc):
   export PATH="${installdir}/bin:$PATH"

   Then restart your terminal or run:
   source ~/.bashrc  # or source ~/.zshrc

2. Verify Installation:
   Run the following command to verify installation:
   ${installdir}/bin/${PRODUCT_SHORT_NAME} --version

3. Documentation:
   View documentation at:
   ${installdir}/docs/

4. Getting Started:
   Launch ${PRODUCT_NAME} by running:
   ${installdir}/bin/${PRODUCT_SHORT_NAME}

5. Uninstall:
   To uninstall ${PRODUCT_NAME}, run:
   ${installdir}/uninstall

For more information, visit the documentation or contact support.

Thank you for installing ${PRODUCT_NAME}!</text>
                        </showInfo>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
            </postShowPageActionList>
        </completionPage>
    </customPageList>

    <!-- Enable Back Button Throughout Installation -->
    <allowBackButton>1</allowBackButton>
    <allowCancelDuringInstall>1</allowCancelDuringInstall>
</project>
